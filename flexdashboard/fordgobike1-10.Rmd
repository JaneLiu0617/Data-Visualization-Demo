---
title: "Stat 650 sec 1 Midterm ----Ford Go Bike"
output:
  word_document: default
  pdf_document: default
  html_notebook: default
---
** Liu, Jiayi**
In this notebook I download and unzip the [Ford Go Bike](https://www.fordgobike.com/) [data](https://www.fordgobike.com/system-data). 

```{r warning=FALSE}
library(tidyverse)
library(tictoc)
library(ggmap)
library(skimr)
library(lubridate)
library(forcats)
library(kableExtra)
```


Create a directory /data in your directory.  Download the files.  First one is not zipped, the remaining are zipped.

```{r results='hide'}

URL <- "https://s3.amazonaws.com/fordgobike-data/2017-fordgobike-tripdata.csv"
download.file(URL, destfile = "./data/2017-fordgobike-tripdata.csv", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201801-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201801-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201802-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201802-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201803-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201803-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201804-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201804-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201805-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201805-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201806-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201806-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201807-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201807-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201808-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201808-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201809-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201809-fordgobike-tripdata.csv.zip", method="libcurl")
URL <- "https://s3.amazonaws.com/fordgobike-data/201810-fordgobike-tripdata.csv.zip"
download.file(URL, destfile = "./data/201810-fordgobike-tripdata.csv.zip", method="libcurl")
```

Loop over the one value in the url and filename that changes.

```{r, results='hide'}

URL <- "https://s3.amazonaws.com/fordgobike-data/2017-fordgobike-tripdata.csv"
download.file(URL, destfile = "./data/2017-fordgobike-tripdata.csv", method="curl")

for (i in 1:10) {
URL <- paste0("https://s3.amazonaws.com/fordgobike-data/20180",i,"-fordgobike-tripdata.csv.zip")
download.file(URL, destfile = paste0("./data/20180",i,"-fordgobike-tripdata.csv.zip"), method="curl")
}
```



Unzip downloaded files.

```{r}
unzip("./data/201801-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201802-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201803-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201804-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201805-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201806-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201807-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201808-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201809-fordgobike-tripdata.csv.zip",exdir="./data")
unzip("./data/201810-fordgobike-tripdata.csv.zip",exdir="./data")
```

Clean up data directory.

```{r results='hide'}
fn <- "./data/201801-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201802-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201803-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201804-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201805-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201806-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201807-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201808-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201809-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
fn <- "./data/201810-fordgobike-tripdata.csv.zip"
if (file.exists(fn)) file.remove(fn)
```

Read the.csv files

```{r message=FALSE}
fordgobike2017 <- read_csv(file="./data/2017-fordgobike-tripdata.csv")
fordgobike201801 <- read_csv(file="./data/201801-fordgobike-tripdata.csv")
fordgobike201802 <- read_csv(file="./data/201802-fordgobike-tripdata.csv")
fordgobike201803 <- read_csv(file="./data/201803-fordgobike-tripdata.csv")
fordgobike201804 <- read_csv(file="./data/201804-fordgobike-tripdata.csv")
fordgobike201805 <- read_csv(file="./data/201805-fordgobike-tripdata.csv")
fordgobike201806 <- read_csv(file="./data/201806-fordgobike-tripdata.csv")
fordgobike201807 <- read_csv(file="./data/201807-fordgobike-tripdata.csv")
fordgobike201808 <- read_csv(file="./data/201808-fordgobike-tripdata.csv")
fordgobike201809 <- read_csv(file="./data/201809-fordgobike-tripdata.csv")
fordgobike201810 <- read_csv(file="./data/201810-fordgobike-tripdata.csv")


```



```{r message=FALSE }
#glimpse(fordgobike201805)
#glimpse(fordgobike201806)
#glimpse(fordgobike201807)
#glimpse(fordgobike201808)
glimpse(fordgobike201808)
glimpse(fordgobike201809)
glimpse(fordgobike201810)

fordgobike201806 <- fordgobike201806 %>%
        mutate(start_station_id = as.integer(start_station_id),
               end_station_id= as.integer(start_station_id) )

fordgobike201807 <- fordgobike201807 %>%
        mutate(start_station_id = as.integer(start_station_id),
               end_station_id= as.integer(start_station_id) )

fordgobike201808 <- fordgobike201808 %>%
        mutate(start_station_id = as.integer(start_station_id),
               end_station_id= as.integer(start_station_id) )
fordgobike201809 <- fordgobike201809 %>%
        mutate(start_station_id = as.integer(start_station_id),
               end_station_id= as.integer(start_station_id) )
fordgobike201810 <- fordgobike201810 %>%
        mutate(start_station_id = as.integer(start_station_id),
               end_station_id= as.integer(start_station_id) )

fordgobike2018 <- bind_rows(fordgobike201801, fordgobike201802, fordgobike201803, fordgobike201804,
                            fordgobike201805, fordgobike201806, fordgobike201807, fordgobike201808,
                            fordgobike201809, fordgobike201810)

#glimpse(fordgobike2018)
#View(fordgobike2018)
```



```{r}
fordgobike2018 %>% select(start_station_id,start_station_name, start_station_latitude,start_station_longitude) %>%
  arrange(start_station_id) %>%
  distinct() %>%
  head() %>%
  kable(, format = "rst")
```

##1. Explain what the GBFS is?
General Bikeshare Feed Specification, known as GBFS, is the open data standard for bikeshare. GBFS will make real-time data feeds publicly available online in a uniform format so that map and transportation based apps can easily incorporate this data into their platforms. Also, the gbfs package supplies a set of functions to interface with General Bikeshare Feed Specification .json feeds in R, allowing users to save and accumulate tidy .rds datasets for specified cities/bikeshare programs.
##2. Explain any difficulties you encountered getting the code to work.
Since I don't want just delete unnecessary code, I tried to use some code into the chunk to hide some big result. I always failed but to add "#" to undo the code.
##3. The analysis is to work with the 2017 and 2018 data. 
How many bike rentals were there in 2017? 519700
How many bike rentals were there in 2018? 1210548
How many bike rentals have there been since the beginning of Ford GoBikes?1730248
##4. There is a part of the code that uses the as.integer() function for some reason. Explain what this function is being used for in the code.
line 175, 176 etc. From glimpse()function, we can find that it is int for start_station_id and end_station_id in 2018/05, while it is chr after 2018/06. When we try to combine the dataset together, we need unionform the type of data for each column.


```{r}
dim(fordgobike2017)

fordgobike2017 %>% count()

#nrow(fordgobike201801) + nrow(fordgobike201802) + nrow(fordgobike201803) + nrow(fordgobike201804)

dim(fordgobike2018)

fordgobike2018 %>% count()

fordgobike <- bind_rows(fordgobike2017, fordgobike2018)

dim(fordgobike)

fordgobike %>% count()

dim(fordgobike)
```

```{r}
# add age, year, month, day and week_day
fordgobike <- fordgobike %>% mutate(age = 2018 - member_birth_year)

fordgobike %>% count() 

dim(fordgobike)

fordgobike <- fordgobike %>% mutate(year=year(start_time), month=month(start_time), day=day(start_time) )

fordgobike %>% count() 

dim(fordgobike)
```
```{r}
fordgobike <- fordgobike %>% mutate(week_day = wday(start_time) )


level <- c("M","T","W","TH","F","SAT","SUN")

fordgobike$week_day <- factor(fordgobike$week_day)

```


```{r}
library(tidyverse)
fordgobike$week_day <- weekdays(as.Date(fordgobike$start_time))
level <- c("M","T","W","TH","F","SAT","SUN")
fordgobike$week_day <- factor(fordgobike$week_day)
dim(fordgobike)
#View(fordgobike)
fordgobike_select<- fordgobike %>%
  select(year,month,user_type)
write.csv(fordgobike_select, "fordgobike_select.csv")
#View(fordgobike)
```

\newpage
```{r}
#library(lubridate)
#library(data.table)
#fordgobike <- fordgobike %>% mutate(week_day = wday(as.POSIXlt(start_time)))
#fordgobike %>% count() 
#dim(fordgobike)
#View(fordgobike)
# week_day seems not work very well. can't change level
```












